{% extends "base.html" %}

{% block content %}

{% if todo_flag %}
{% set orig_date = '' %}
{% else %}
{% set orig_date = sde.date %}
{% end %}
<header>
  <script>
    const update_wday = () => {
        const el1 = document.getElementById("date");
        const d1 = new Date(el1.value);

        const el2 = document.getElementById("wday");
        el2.innerHTML = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'][d1.getDay()]
    };

    const mkInput = (cmd) => {
        const input = document.createElement("input");
        input.setAttribute("type", "hidden");
        input.setAttribute("name", "cmd");
        input.setAttribute("value", cmd);
        return input;
    };

    const doSubmit = (cmd) => {
        form = document.forms["input_form"];
        form.appendChild(mkInput(cmd));
        form.submit();
    };

    const changeDate = (d) => {
        const el = document.getElementById("date");
        let d1 = new Date(el.value);
        d1.setDate(d1.getDate() + d);
        console.log(`d1=${d1}`);
        d1_str = d1.toISOString().replace(/T.*$/, '');

        el.value = d1_str;
        update_wday();
    };
  </script>
  
  <div class="container-fluid p-0 fixed-top my-bar">
    <div class="row p-0 m-1">

      <div class="col-2 text-center" ontouchstart="history.back();">
        <i class="fas fa-reply fa-2x" ></i>
      </div><!-- col -->
      
      <div class="col-1"></div>

      <div class="col-2 text-center" ontouchstart="doSubmit('add');">
        <i class="fas fa-plus-square fa-2x"></i>
      </div><!-- col -->

      <div class="col-1"></div>

      <div class="col-2 text-center" ontouchstart="doSubmit('fix');">
        <i class="fas fa-check-square fa-2x"></i>
      </div><!-- col -->

      <div class="col-2">
      </div>
      
      <div class="col-2 text-center" onclick="doSubmit('del');">
        <i class="fas fa-trash-alt fa-2x"></i>
      </div><!-- col -->

    </div><!-- row -->
  </div><!-- container -->
</header>
<main style="background-color: #FFF; padding-top: 40px;">
  <form id="input_form" name="input_form"
        action="{{ url_prefix }}" method="POST">

    <input id="orig_date" name="orig_date"
           type="hidden" value="{{ orig_date }}" />

    <div class="container-fluid"
         style="background-color: #EEE;">
      <div class="row">
        &nbsp;
      </div>

      <!-- 日付 -->
      <div class="row" style="font-size: large">
        <div class="col-2 text-center"
             ontouchstart="changeDate(1);">
          <i class="far fa-arrow-alt-circle-down fa-2x"></i>
        </div>

        <div class="col-2 text-center"
             ontouchstart="changeDate(-1);">
          <i class="far fa-arrow-alt-circle-up fa-2x"></i>
        </div>

        <div class="col-8 p-0 text-left">
          <input id="date" name="date"
                 type="date" value="{{ sde.date }}"
                 onchange="update_wday();" />
          (<span id="wday">{{ date.strftime('%a') }}</span>)
        </div><!-- col -->
      </div><!-- row -->

      <div class="row">
        &nbsp;
      </div>

      <!-- 時刻 -->
      <div class="row" style="font-size: x-large">
        <div class="col">
          <input id="time_start" name="time_start" style="width: 100px;"
                 type="time" value="{{ sde.time_start }}" />
          ～
          <input id="time_end" name="time_end" style="width: 100px;"
                 type="time" value="{{ sde.time_end }}" />
        </div><!-- col -->
      </div><!-- row -->

      <div class="row">
        &nbsp;
      </div>

      <!-- Type -->
      <div class="row" style="font-size: x-large;">
        <div class="col">
          <span style="font-size: xx-large; font-width: bold;">【</span>
          <input id="sde_type" name="sde_type"
                 type="text" value="{{ sde.type }}"
                 style="width:70%;" />
          <span style="font-size: xx-large; font-width: bold">】</span>
        </div><!-- col -->
      </div><!-- row -->

      <!-- タイトル -->
      <div class="row" style="font-size: x-large;">
        <div class="col">
          <input id="title" name="title" style="width: 100%;"
                 type="text" value="{{ sde.title }}" />
        </div><!-- col -->
      </div><!-- row -->

      <!-- 場所 -->
      <div class="row" style="font-size: x-large;">
        <div class="col">
          <span style="font-size: large">@</span>
          <input id="place" name="place" style="width: 93.5%;"
                 type="text" value="{{ sde.place }}" size="30" />
        </div><!-- col -->
      </div><!-- row -->

      <!-- 詳細 -->
      <div class="row" style="font-size: large;">
        <div class="col">
          <textarea id="text" name="text" style="width: 100%;"
                    rows="8">
            {{ sde.text }}
          </textarea>
        </div><!-- col -->
      </div><!-- row -->

      <!-- ID -->
      <div class="row" style="font-size: x-small">
        <div class="col">
          <input id="sde_id" name="sde_id"
                 type="text" value="{{ sde.id }}" readonly>
        </div><!-- col -->
      </div><!-- row -->

    </div><!-- container -->
  </form>
</main>
{% end %}
